<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
    <meta name="application-name" content="IPF Points Calculator">
    <meta name="description" content="Online Calculator for IPF Points">
    <meta name="keywords" content="IPF,IPF Points,IPF score,IPF formula,USAPL,powerlifting,calculator,wilks">

    <style>
      body {
        background-image: linear-gradient(to right, gold, orange);
      }
      h2 {
        font-style: italic;
        color: gold;
        text-shadow: 1px 1px 4px black;
      }
    </style>

    <title>IPF Points Calculator, from your friends at OpenPowerlifting</title>
  </head>
  <body>
    <header>
      <h2>IPF Points Calculator</h2>
      <p>
        This is <a href="https://gitlab.com/openpowerlifting/ipf-points-calculator">Free and Open Source Software</a> from your friends at <a href="https://www.openpowerlifting.org">OpenPowerlifting</a>.
      </p>
      <p>
        This webapp is not affiliated with <a href="https://www.powerlifting.sport/">the IPF</a>.
      </p>
      <p>
        Want to support more powerlifting software? <a href="https://www.patreon.com/openpowerlifting">Donate to the cause!</a>
      </p>
    </header>
    <div>
      <input type="radio" id="kilograms" name="units" value="kg" onchange="calc()" checked>
      <label for="kilograms">Kilograms</label>
      <input type="radio" id="pounds" name="units" value="lbs" onchange="calc()">
      <label for="pounds">Pounds</label>

      <input type="radio" id="men" name="sex" value="M" onchange="calc()" checked>
      <label for="men">Men</label>
      <input type="radio" id="women" name="sex" value="F" onchange="calc()">
      <label for="women">Women</label>

      <input type="radio" id="raw" name="equipment" value="Raw" onchange="calc()" checked>
      <label for="raw">Raw</label>
      <input type="radio" id="single" name="equipment" value="Single-ply" onchange="calc()">
      <label for="single">Single-ply</label>

      <input type="radio" id="sbd" name="event" value="SBD" onchange="calc()" checked>
      <label for="sbd">Full Power</label>
      <input type="radio" id="s" name="event" value="S" onchange="calc()">
      <label for="s">Squat only</label>
      <input type="radio" id="b" name="event" value="B" onchange="calc()">
      <label for="b">Bench only</label>
      <input type="radio" id="d" name="event" value="D" onchange="calc()">
      <label for="d">Deadlift only</label>

      <input type="number" id="bodyweight" name="bodyweight" min="0" step="0.1" oninput="calc()">
      <label for="bodyweight">Bodyweight</label>

      <input type="number" id="total" name="total" min="0" step="0.1" oninput="calc()">
      <label for="total">Weight Lifted</label>

      <input type="button" value="Calculate" onclick="calc()">

      <div id="display">
      </div>
    </div>

    <script>
      // https://en.wikipedia.org/wiki/Error_function#Polynomial
      // Agrees with the Rust implementation to about 6 decimal places.
      function erf(x) {
        var t = 1.0/(1.0+Math.abs(x)/2.0);
        var t2=t*t,t3=t2*t,t4=t3*t,t5=t4*t,t6=t5*t,t7=t6*t,t8=t7*t,t9=t8*t;
        var tau = t * Math.exp(-x*x - 1.26551223 + 1.00002368*t + 0.37409196*t2 +
                  0.09678418*t3 - 0.18628806*t4 + 0.27886807*t5 - 1.13520398*t6 +
                  1.48851587*t7 - 0.82215223*t8 + 0.17087277*t9);
        if (x >= 0.0) { return 1.0 - tau; }
        return tau - 1.0;
      }
      function cumulative_normal(x, mean, deviation) {
        return 0.5 * (1.0 + erf((x - mean) / (deviation * Math.SQRT2)));
      }

      var PARAMETERS = {
        "M": {
          "Raw": {
            "SBD": [310.67, 857.785, 53.21602246, 147.0835213],
            "S": [123.1, 363.085, 25.16669173, 75.43114253],
            "B": [86.4745, 259.155, 17.57845791, 53.12202336],
            "D": [103.5355, 244.765, 15.3713591, 31.50223091]
          },
          "Single-ply": {
            "SBD": [387.265, 1121.28, 80.63242593, 222.4895974],
            "S": [150.485, 446.445, 36.51551612, 103.7060711],
            "B": [133.94, 441.465, 35.39379355, 113.0057151],
            "D": [110.135, 263.66, 14.99598937, 23.01097909]
          }
        },
        "F": {
          "Raw": {
            "SBD": [125.1435, 228.03, 34.52461523, 86.83009976],
            "S": [50.479, 105.632, 19.18458916, 56.22148694],
            "B": [25.0485, 43.848, 6.717175515, 13.95197273],
            "D": [47.136, 67.349, 9.155512107, 13.66997543],
          },
          "Single-ply": {
            "SBD": [176.58, 373.315, 48.45340151, 110.0102772],
            "S": [74.6855, 171.585, 21.94753597, 52.2948313],
            "B": [49.106, 124.209, 23.19897729, 67.4926054],
            "D": [51.002, 69.8265, 8.58023763, 5.725798366]
          }
        }
      };

      function getRadioValue(name) {
        var radios = document.getElementsByName(name);
        for (var i = 0; i < radios.length; ++i) {
          if (radios[i].checked) { return radios[i].value; }
        }
      }

      function calc() {
        var units = getRadioValue("units");
        var sex = getRadioValue("sex");
        var equipment = getRadioValue("equipment");
        var event = getRadioValue("event");
        var bw = Number(document.getElementById("bodyweight").value);
        var total = Number(document.getElementById("total").value);

        if (units === "lbs") {
          bw = bw / 2.20462262;
          total = total / 2.20462262;
        }

        var params = PARAMETERS[sex][equipment][event]
        var mean = params[0] * Math.log(bw) - params[1];
        var dev = params[2] * Math.log(bw) - params[3];

        var points = cumulative_normal(total, mean, dev);

        document.getElementById("display").innerHTML = String(points);
      }
    </script>
  </body>
</html>
